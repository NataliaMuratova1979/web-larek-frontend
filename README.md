# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами
- src/utils/objects.ts — файл c массивом объектов товаров 


## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

1. export interface IProduct\
*Это объект - Товар, который мы получаем с сервера. Мы не можем редактировать эти данные. Мы можем отображать товар, используя эти данные.*
- id: string;
- description: string;
- image: string;
- title: string;
- category: string;
- price: number;


2. export interface IOrder\ 
*Это объект - Заказ, изначально он пустой.*
- payment: string;
- email: string;
- phone: string;
- address: string;
- total: IProductOrderPrice[];
- items: IProductData; *это массив карточек, добавленных в корзинку*
- addOrderData() *добавляем данные в объект заказа*
- getTotal( IProductOrderPrice[] ) *получаем сумму заказанных товаров*
- setOrder(): *тут собираем все данные для отправления заказа на сервер*
- getOrder(): *метод возвращает данные, полученные с сервера после успешной отправки заказа*
- checkValidation(data: Record<keyof IOrderFormData, string>): boolean;

3. Коллекция, каталог товаров\
export interface IProductData\
*это данные товаров и действия, которые мы можем с ними выполнять*
-products: IProduct[];
- preview: string | null; // указатель на тот товар, который мы хотим посмотреть 
- addProduct(product: IProduct): void;
- deleteProduct(productId: string, payload: Function | null): void;
- getProduct(productId: string): IProduct;

4. export type IProductMainPage = Pick<IProduct, 'image' | 'title' | 'category' | 'price'>

5. export type IProductPopup = Pick<IProduct, 'image' | 'title' | 'category' | 'price' | 'description'>

6. export type IProductToAdd = Pick<IProduct, 'id' | 'title' | 'price' >
 
7. export type IProductOrderPrice = Pick<IProduct, 'price'> *Здесь должна быть цена выбранного товара*

8. export type IOrderFormData = Pick<IOrder, 'payment' | 'address' | 'email' | 'phone'> *Данные, вводимые в формы при оформлении заказа*

8. export type IOrderProducts = Pick<IOrder, 'items'> *Список товаров, добавленных в корзину*

## Архитектура приложения

- слой представления отечает за отображение данных на странице
- слой данных отвечает за хранение и изменение данных
- презентер отвечает за связь представления и данных


### Базовый код

Класс АPI содержит базовую логику отправки запросов.

#### Класс EventEmitter
 
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий. 
Основные методы, реализуемые классом, описаны интерфейсом 'IEvents': 

export interface IEvents {
    // подписка на событие:
    on<T extends object>(event: EventName, callback: (data: T) => void): void;

    // инициализация события:
    emit<T extends object>(event: string, data?: T): void;

    // возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие:
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
}
'''

### Слой данных 

Один класс будет отвечать за работу с товарами, другой класс - за работу с заказом. 

#### Класс ProductData
Класс отвечает за хранение и логику работы с данными товаров, отображаемых на странице и добавляемых в корзинку.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _products: IProduct[] - массив объектов товаров
- _preview: string | null - id товара, выбранного для просмотра в модальном окне
- events: IEvent - экземпляр класса `EventEmitter`

Также класс предоставляет набор методов для взаимодействия с этими данными.
 
- addProduct(product: IProduct): void - добавляет одну карточку товара в конец массива и вызывает событие изменения массива.
- deleteProduct(productId: string, payload: Function | null): void - удаляет карточку из массива. Если передан колбэк, то выполняет его после удаления, если нет, то вызывает событие изменени массива.
- getProduct(productId: string): IProduct - возвращает товар по его id;
- сеттеры и геттеры;


#### Класс OrderData
Класс отвечает за хранение и логику работы с данными заказа.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- payment: string - информация о способе оплаты
- email: string - информация о email заказчика
- phone: string - информация о телефоне заказчика
- address: string - информация о телефоне заказчика
- total: IProductOrderedPrice[] - информация о сумме заказа
- items: IProduct[] - информация о массиве карточек, добавленных в корзинку 
- events: IEvent - экземпляр класса `EventEmitter`

Также класс предоставляет набор методов для взаимодействия с этими данными.
- addOrderData - добавляем данные в объект заказа
- getTotal - получаем сумму заказа
- метод для подсчета количества заказанных товаров;
- setOrder() - отправляем данные на сервер
- getOrder() - метод возвращает данные, полученные с сервера после успешной отправки заказа
- checkValidation(data: Record<keyof IOrderFormData, string>): boolean;
- cleanOrder - очищаем объект заказа 

### Слой представления 
Все классы представляния отвечают за отображения внутри контейнера (DOM-элемент) передаваемых в них данных. 

#### Класс Modal
Исходя из верстки, у нас есть одно модальное окно, внутри которого размещается контент вызванного модального окна. 
Внутри может быть:\
- div class="modal__container\
- div class="card card_full карточка с полным описанием товара и - кнопка в корзину\
- div class="basket" - корзина со всеми выбранными товарами и кнопка оформить\
- form class="form"> - форма заполнения данных покупателя и кнопка далее\
- form class="form"> - форма заполнения данных покупателя и кнопка оплатить\
- div class="order-success"> - извещение об успешном оформлении заказа и кнопка перехода на главную страницу\


Это реализуется путем вставления внутрь модального окна таких шаблонов (последовательность взята из верстки): 
- template id="success">
- template id="card-catalog">
- template id="card-preview">
- template id="card-basket">
- template id="basket">
- template id="order">
- template id="contacts">
Соответственно, как происходит работа с модальными окнами?
Пользователь нажимает определенную кнопку, открывается модальное окно, внутри которого определенный DOM-элемент. Таким образом реализуется метод `open`.

Также предоставляетcя метод `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

- constructor(selector: string, events: IEvents) Конструктор принимает темплейт, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий
- openButton: HTMLButtonElement - кнопка отрытия модального окна
- goFurtherButton: HTMLButtonElement - кнопка, открывающая следующее модальное окно (или завершающая заказ)
- handleSubmit: Function - функция, которая будет выполняться после подтвеждения

#### Класс ModalWithForm
Расширяет класс Modal. Предназначен для реализации модального окна с формой, содержащей поля ввода. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\
- submitButton: HTMLButtonElement - кнопка подтверждения
- _form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы
- errors: Record<string, HTMLElement> - объект, хранящий все эелементыдля вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getInputValues(): Record<string, string> - возвращает объект с данными из полей форы, гд ключ - name инпута, значение - данные, введенные пользователем
- setInputValues(data: Record<string, string>): void - принимает объект с данными для заполнения полей формы
- setError(data: { field: string, value: string, validInformation: string}): void - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- showInputError (field: string, errorMessage: string): void - отображает полученный текс ошибки под указанным полем ввода.
- hidInputError (field: strint): void - очищает текст ошибки под указанным полем ввода
- close (): void - расширяет родительский метод дополнительно при закрытии, очищая поля формы и деактивируя кнопку сохранения
- get form: HTMLElement - геттер для получения элемента формы

#### Класс ModalWithProducts
Расширяет класс Modal. Предназачен для реализации модального окна с информацией о товаре. При открытии модального окна получает данные о товаре (товарах), которые нужно показать.\
Поля класса (в разных модальных окнах разные комбинации):
- description: string;
- image: string;
- title: string;
- category: string;
- price: number

Методы
- open(data: {} ): void - расширение родительского метода, принимает данныетовара, которые используются для заполнения атрибутов модального окна
- close(): void - расширяет родительский метод, выполняя дополнительно очистку атрибутов модального окна. 

### Класс Product
Отвечает за отображение товара, задавая в товаре данные названия, описания, изображения, цены. Класс используется для отображения товара на главной странице, в модальном окне, в корзине. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать разные варианты верстки товара. Слушатель событий отслеживает, на какую карточку произошел клик. 

Методы
- setData(productData: IProduct): void - заполняет атрибуты элементов товара данными
- render(): HTMLElement - метод возвращает заполненный элемент товара
- геттер id возвращает уникальный id выбранной карточки

#### Класс ProductsContainer
Отвечает за отбражения блока с карточками на главной странице или в корзине покупок. В конструктор принимает контейнер, в котором размещаются карточки. Предоставляет метод удаления карточки (для контейнера корзины). Здесь должен быть слушатель событий - для добавления карточек в корзину и удаления карточек из корзины. 
Сеттер `container` - для отображения товаров на главной странице или в корзине. 


### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

#### Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой, находится в файле `index.ts`, выполняющий роль презентера.\
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий. 

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `order:changed` - изменение данных заказа 
- `order:submit` - сохранение заказа по нажатию кнопки оплатить, отправка данных на сервер и получение с сервера подтвердение заказа


*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представления)*\
- `product:open` - выбор товара для просмотра в модальном окне
- `product:select` - добавление товара в корзину - обновляем массив данных в корзине
- `basket:select` - открываем корзину для просмотра - выводим данные корзины 
- `basket:changed` - изменение массива товаров в корзине = изменение массива данных заказа
- `product:delete` - удаляем товар из корзины - обновляем массив данных в корзине 
- `orderFormFirst:open` - открытие первого модального окна с формой редактирования заказа
- `orderFormSecond:open` - открытие второго модального окна с формой редактирования заказа
- `payWay:select` - выбор способа оплаты - вводим данные в объект заказа - делаем кнопку активной
- `address:input` - изменение данных в форме с данными адреса
- `email:input` - изменение данных в форме с данными почты
- `phone:input` - изменение данных в форме с данными телефона
- `address:validation` - событие, сообщающее о необходимости валидации формы с адресом
- `email:validation` - событие, сообщающее о необходимости валидации формы с почтой
- `phone:validation` - событие, сообщающее о необходимости валидации формы с телефоном
- `mainpage:open` - закрываем модальное окно и открываем главную страницу
- `orderForm:clear` - необходима очистка данных, введенных в форму

__________________________________________________________________

#### Черновик

Что можно делать с данными товара:
1. Мы получаем с сервера массив объектов товара с набором данных.
2. Для каждого объекта мы рисуем карточку товара на главной странице, отображая часть данных.
3. При клике на карточку товара мы рисуем попап товара, отображая все данные. 
4. При клике на кнопку "В корзину" мы добавляем объект в массив заказанных товаров. 
5. Мы можем удалать товар из корзины. 

Что может делать функция-колбэк:
- открыть попап с карточкой товара 
- добавить товар в массив заказанных товаров 

Что можно делать с данными заказа:
1. Валидировать их
2. Отправлять на сервер

Что можно сделать с корзиной?
1. Мы кладем туда товары (== создаем массив товаров для заказа).
2. Мы рисуем модальное окно Корзина (== отображаем список товаров в массиве. Каждый товар имеет набор данных).
3. Мы суммируем стоимость всех заказанных товаров.
4. Мы можем удалять товары из массива. Общая стоимость должна меняться.
5. Мы можем подтвердить оформление заказа (== кнопка "Оформить" становится активной).
6. Мы можем проверить наличие товара в массиве (кнопка "Оформить" не становится активной).
7. Мы можем закрыть корзину. 

Что можно сделать с формой:
1. Мы рисуем модальное окно формы.
2. Внести данные в инпуты.
3. Валидировать данные. 
4. Активировать кнопку в случае верных данных.
2. Мы можем закрыть форму без сохранения данных.

Обработчик будет
1. Получать данные из формы.
2. Добавляет данные в объект данных заказа.
3. При сабмите последней формы - отправлять данные заказа на сервер и получать список id заказанных товаров, а также суммарную стоимость. 

Пользовательские сценарии

1. Получить данные товаров с сервера
2. Отобразить товары, используя данные, полученные с сервера

Компоненты

- Главная страница => Карточки товаров на главной странице
- Главная страница => Значок корзины с количеством выбранных товаров
- Модальное окно с подробной информацией о товаре
- Модальное окно Корзина => cтроки с информацией о товарах
- Модальное окно с формой способ оплаты + адрес доставки
- Модальное окно с формой почта + телефон
- Модальное окно подтверждение оформления заказа (есть данные об общей стоимости товара)

Заказ - создается пустой объект, который мы заполняем данными, которые вводим в форму

Класс создает объект товара. 
Класс отвечает за работу с данными товара и отображение карточек.\
Конструктор класса принимает инстант брокера событий.\

