# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами
- src/utils/objects.ts — файл c массивом объектов товаров 


## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

1. Это объект - Товар, который мы получаем с сервера
Мы не можем редактировать эти данные
Мы можем отображать товар, используя эти данные
 interface IProduct {  
        id: string;
        description: string;
        image: string;
        title: string;
        category: string;
        price: number;
        ordered: boolean;
    }

2. Это объект - Заказ, изначально он пустой. Мы будем отраправлять его на сервер.
 interface IOrderData {
        basket: IProduct[];
        userContacts: IUserContacts;
        userPayment: IUserPayment;    
    }

3. Это объект - Контакты пользователя. Мы будем получать их через форму и отправлять на сервер.
 interface IUserPayment {
    payment: string;
    address: string;
}

4. Это объект - Контакты пользователя. Мы будем получать их через форму и отправлять на сервер.
 interface IUserContacts  {
    email: string;
    phone: string;
}

5. Это объект - данные заказа, сформированные для отправки на сервер.
 interface IOrderSendData { 
    payment: string;
    email: string;
    phone: string;
    address: string;
    total: number;
 }

6. Это объект - это данные, получаемые с сервера после успешной отправки заказа 
 interface IOrderSendData { 
 export interface IResponse 
    id: string;
    total: number;
}
     
    // Коллекция, каталог товаров
7. interface IProductData { // это данные товаров и действия, которые мы можем с ними выполнять
    products: IProduct[];
    preview: string | null; // указатель на тот товар, который мы хотим посмотреть       
    getProduct(productId: string): IProduct;
}
    

## Архитектура приложения

- слой представления отечает за отображение данных на странице
- слой данных отвечает за хранение и изменение данных
- презентер отвечает за связь представления и данных

### Базовый код

Класс АPI содержит базовую логику отправки запросов.

#### Класс EventEmitter
 
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий. 
Основные методы, реализуемые классом, описаны интерфейсом 'IEvents': 

export interface IEvents {
    // подписка на событие:
    on<T extends object>(event: EventName, callback: (data: T) => void): void;

    // инициализация события:
    emit<T extends object>(event: string, data?: T): void;

    // возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие:
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
}
'''

### Слой данных 

Один класс будет отвечать за работу с товарами, другой класс - за работу с заказом. 

#### Класс ProductData
Класс отвечает за хранение и логику работы с данными товаров, отображаемых на странице и добавляемых в корзинку.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _products: IProduct[] - массив объектов товаров
- _preview: string | null - id товара, выбранного для просмотра в модальном окне
- events: IEvent - экземпляр класса `EventEmitter`

Также класс предоставляет набор методов для взаимодействия с этими данными.
 
- addProduct(product: IProduct): void - добавляет одну карточку товара в конец массива и вызывает событие изменения массива.
- deleteProduct(productId: string, payload: Function | null): void - удаляет карточку из массива. Если передан колбэк, то выполняет его после удаления, если нет, то вызывает событие изменени массива.
- getProduct(productId: string): IProduct - возвращает товар по его id;
- getProducts - массив товаров
- сеттеры и геттеры;
- getTotal - количество всех товаров 

#### Класс OrderData
Класс отвечает за хранение и логику работы с данными товаров, добавленных в корзину.\
Данные товаров - это массив объектов товаров. Их можно добавлять и удалять, а также подсчитывать общую стоимость товаров, добавленных в корзину. 
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
   _basket: IProduct[]; - массив товаров
    userPayment: IUserPayment = { - данные пользователя
        payment: '',
        address: ''
    };
    userContacts: IUserContacts = { - данные пользователя
        email: '',
        phone: ''
    };

Также класс предоставляет набор методов для взаимодействия с этими данными.
 
- addProduct(product: IProduct): void - добавляет одну карточку товара в конец массива и вызывает событие изменения массива.
- getTotal - показывает количество товаров в корзине 
- totalPrice() - показывает общую стоимость 
- getOrder - возвращает заказ
- clearOrder - очищает корзину
- setPaymentField, setContactsField, validatePaymentForm, validateContactsForm - поля для установки значения и валидации полей форм


### Слой представления 
Все классы представляния отвечают за отображения внутри контейнера (DOM-элемент) передаваемых в них данных. 

### Класс Component
Класс Component содержит защищённое свойство element, которое является элементом, с которым будет работать компонент. Также класс содержит метод render(), который должен быть реализован в каждом классе-наследнике. Остальные классы наследуются от Component.

#### Класс Modal
Класс наследует класс Component, при этом добавляются элементы для открытия и закрытия модального окна.
Исходя из верстки, у нас есть одно модальное окно, внутри которого размещается контент вызванного модального окна. 
Внутри может быть:\
- div class="modal__container\
- div class="card card_full карточка с полным описанием товара и - кнопка в корзину\
- div class="basket" - корзина со всеми выбранными товарами и кнопка оформить\
- form class="form"> - форма заполнения данных покупателя и кнопка далее\
- form class="form"> - форма заполнения данных покупателя и кнопка оплатить\
- div class="order-success"> - извещение об успешном оформлении заказа и кнопка перехода на главную страницу\

Это реализуется путем вставления внутрь модального окна таких шаблонов (последовательность взята из верстки): 
- template id="success">
- template id="card-catalog">
- template id="card-preview">
- template id="card-basket">
- template id="basket">
- template id="order">
- template id="contacts">
Соответственно, как происходит работа с модальными окнами?
Пользователь нажимает определенную кнопку, открывается модальное окно, внутри которого определенный DOM-элемент. Таким образом реализуется метод `open`.

Также предоставляетcя метод `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

- constructor(selector: string, events: IEvents) Конструктор принимает темплейт, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- events: IEvents - брокер событий
- openButton: HTMLButtonElement - кнопка отрытия модального окна
- goFurtherButton: HTMLButtonElement - кнопка, открывающая следующее модальное окно (или завершающая заказ)
- handleSubmit: Function - функция, которая будет выполняться после подтвеждения
- close (): закрытие модального окна

#### Класс Form (два класса)
(FormContacts FormPayment 
Наследует класс Component. При этом добавляются возможности вводить данные, а также совершать с ними действия (submit).
Предназначен для реализации модального окна с формой, содержащей поля ввода. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\
- submitButton: HTMLButtonElement - кнопка подтверждения
- _form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы
- errors: Record<string, HTMLElement> - объект, хранящий все эелементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы:
- onInputChange - поле для отслеживания вводимого значения


### Класс Card
Отвечает за отображение товара, задавая в товаре данные названия, описания, изображения, цены. Класс используется для отображения товара на главной странице, в модальном окне, в корзине. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать разные варианты верстки товара. Слушатель событий отслеживает, на какую карточку произошел клик. 
Поля класса (в разных модальных окнах разные комбинации):
- template для отрисовки конкретного отображения 
- description: string;
- image: string;
- title: string;
- category: string;
- price: number;
- id: string;
- index;

Методы
- сеттеры и геттеры для установки значений 
- render(): HTMLElement - метод возвращает заполненный элемент товара
- геттер id возвращает уникальный id выбранной карточки

Пример создания
const cardBasket = new Card(productTemlate, events)


### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

#### Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой, находится в файле `index.ts`, выполняющий роль презентера.\
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий. 

#### Цепочки основных событий (названия методов будут переименованы в процессе написания кода):


Событие 1. Загружаем карточки на страницу.
С сервера приходят данные товаров.
Срабатывает событие `products:loaded`
На странице отображаются карточки товаров.

Событие 2. Пользователь кликнул на карточку товара на главной странице.
Срабатывает событие `card:open`.
В модальном окне отрисовываются данные кликнутой карточки. 

Событие 3. Пользователь кликнул на кнопку "В корзину".
В классе отображения карточки срабатывает событие `product:add`.
Действие переходит в класс данных OrderData. Срабатывает метод addProduct, который вызывает событие `basket:changed`.

Событие 4. Пользователь кликнул на значок удаления товара из корзины.
В классе Сard срабатывает событие `product:delete`.
В классе OrderData вызывается метод deleteProduct, которое удалит товар из массива заказанных и после отработки которого возникает событие `basket:open`, которое заново отрисует модальное окно с товаром корзины.

Событие 5. Обновился массив данных в корзине. Срабатывает событие `basket:changed`. В классе отображения BasketCounter обновляется значение счетчика на корзинке на главной странице. 

Событие 6. Пользователь нажал на кнопку Оформить в корзине.
В классе OrderData сработало событие `formPayment:open`. 
Необходимо отрисовать форму заполнения данных.
После успешного заполнения каждого инпута срабатывает метод setPaymentFieldю событие `formContacts:open` и открывается форма FormContacts. 

Событие 7. После успешного заполнения данных в форме FormContacts
Произошло событие `order:submit`. 

Событие 8. Пользователь заполнил поля формы и кликнул на кнопку Оплатить. Сработало событие `order:send`. Формируется объект заказа и отправляется на сервер. 

Событие 9. После успешной отправки заказа на сервер. Срабатывает событие `order:sent`, очищается массив товаров в классе OrderData, обнуляется счетчик на корзинке, отрисовывается модальное окно с сообщением об успешной отправке заказа (класс Success).




 

__________________________________________________________________

#### Черновик

Что можно делать с данными товара:
1. Мы получаем с сервера массив объектов товара с набором данных.
2. Для каждого объекта мы рисуем карточку товара на главной странице, отображая часть данных.
3. При клике на карточку товара мы рисуем попап товара, отображая все данные. 
4. При клике на кнопку "В корзину" мы добавляем объект в массив заказанных товаров. 
5. Мы можем удалать товар из корзины. 

Что может делать функция-колбэк:
- открыть попап с карточкой товара 
- добавить товар в массив заказанных товаров 

Что можно делать с данными заказа:
1. Валидировать их
2. Отправлять на сервер

Что можно сделать с корзиной?
1. Мы кладем туда товары (== создаем массив товаров для заказа).
2. Мы рисуем модальное окно Корзина (== отображаем список товаров в массиве. Каждый товар имеет набор данных).
3. Мы суммируем стоимость всех заказанных товаров.
4. Мы можем удалять товары из массива. Общая стоимость должна меняться.
5. Мы можем подтвердить оформление заказа (== кнопка "Оформить" становится активной).
6. Мы можем проверить наличие товара в массиве (кнопка "Оформить" не становится активной).
7. Мы можем закрыть корзину. 

Что можно сделать с формой:
1. Мы рисуем модальное окно формы.
2. Внести данные в инпуты.
3. Валидировать данные. 
4. Активировать кнопку в случае верных данных.
2. Мы можем закрыть форму без сохранения данных.

Обработчик будет
1. Получать данные из формы.
2. Добавляет данные в объект данных заказа.
3. При сабмите последней формы - отправлять данные заказа на сервер и получать список id заказанных товаров, а также суммарную стоимость. 

Пользовательские сценарии

1. Получить данные товаров с сервера
2. Отобразить товары, используя данные, полученные с сервера

Компоненты

- Главная страница => Карточки товаров на главной странице
- Главная страница => Значок корзины с количеством выбранных товаров
- Модальное окно с подробной информацией о товаре
- Модальное окно Корзина => cтроки с информацией о товарах
- Модальное окно с формой способ оплаты + адрес доставки
- Модальное окно с формой почта + телефон
- Модальное окно подтверждение оформления заказа (есть данные об общей стоимости товара)

Заказ - создается пустой объект, который мы заполняем данными, которые вводим в форму

Класс создает объект товара. 
Класс отвечает за работу с данными товара и отображение карточек.\
Конструктор класса принимает инстант брокера событий.\



